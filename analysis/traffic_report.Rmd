---
date: '`r strftime(Sys.time(), format = "%B %d, %Y")`'
title: '`UP Pineway Traffic Report'
output: 
  html_document:
    theme: flatly
---

```{r, include = FALSE}
#source('analysis/plot.R')


# # counts by hour
# c_by_hour <- data_processed %>%
#   group_by(Date, Hour) %>%
#   summarise(Count = n()) %>%
#   ungroup() %>%
#   ggplot(aes(x=Hour, y=Count)) +
#   facet_wrap(~Date, ncol = 1) +
#   geom_step() +
#   theme_minimal() +
#   ylab('Count of Vehicles by Hour') +
#   xlab('Time') +
#   ggsci::scale_color_lancet()

# avg speed by hour
s_by_hour <- data_processed %>%
	  group_by(Date, Hour) %>%
	    summarise(Speed = mean(Speed)) %>%
	      ungroup() %>%
	        ggplot(aes(x=Hour, y=Speed)) +
		  facet_wrap(~Date, ncol = 1) +
		    geom_step() +
		      theme_minimal() +
		        xlab('Time') +
			  ggsci::scale_color_lancet() + ylab('Average Speed (mph)')

		  # split by dir
		  c_by_hour_split_dir <- data_processed %>%
			    group_by(Date, Hour, Direction) %>%
			      summarise(Count = n()) %>%
			        ungroup() %>%
				  ggplot(aes(x=Hour, y=Count, colour = Direction)) +
				    facet_wrap(~Date, ncol = 1) +
				      geom_step() +
				        theme_minimal() +
					  ylab('Count of Vehicles by Hour') +
					    xlab('Time') +
					      ggsci::scale_color_lancet()

				      # grab legend
				      legend_b <- cowplot::get_legend(c_by_hour_split_dir + theme(legend.position="right"))
```

## Daily Traffic Report {.tabset}
```{r}
cowplot::plot_grid(s_by_hour,
                   c_by_hour_split_dir + theme(legend.position = 'none'),
                   legend_b,
                   ncol=3,
                   rel_widths = c(1,1,0.25))
```

## Info {.tabset}
This report is generated by using a Raspberry Pi 3b+ with an attached camera. The camera, using the [speed-camera](https://github.com/pageauc/speed-camera) package, constantly monitors the scene and tracks moving objects. Each moving object is logged with the estimated speed and photographed. Objects logged within a second are grouped into one event. The plots are aggregated to display counts of events for each hour and the average speed of all detected objects each hour. While pedestrians can theoretically be captured, it seems the system does not capture many pedestrian events.
